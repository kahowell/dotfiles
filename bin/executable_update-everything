#!/bin/bash
case $@ in
  "-y") CONFIRM_ARG=-y ;;
  "") CONFIRM_ARG='' ;;
  *) echo "Usage: $0 [-y]"; exit 1 ;;
esac
echo ðŸ“¦Updating Ansible role
sudo ansible-pull -o -U https://github.com/kahowell/kahowell-environment -d /etc/ansible/roles/kahowell-environment /etc/ansible/roles/kahowell-environment/provision.yml
echo ðŸ“¦Updating dotfiles
chezmoi update
echo ðŸ“¦Updating dnf packages
sudo dnf update $CONFIRM_ARG
echo ðŸ“¦Updating brew packages
sudo -u linuxbrew bash -c "/home/linuxbrew/.linuxbrew/bin/brew update && /home/linuxbrew/.linuxbrew/bin/brew upgrade && /home/linuxbrew/.linuxbrew/bin/brew cleanup"
echo ðŸ“¦Updating flatpaks
flatpak upgrade $CONFIRM_ARG && flatpak uninstall --unused $CONFIRM_ARG
echo ðŸ“¦Updating firmware
fwupdmgr update $CONFIRM_ARG
echo ðŸ“¦Updating python-based tools
sudo pipx --global upgrade-all
echo ðŸ“¦Updating node-based tools
sudo npm update -g $(npm list -g --json | jq -r '.dependencies | keys | .[]')
